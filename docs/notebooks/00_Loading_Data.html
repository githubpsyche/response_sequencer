<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ResponseSequencer - 1&nbsp; Data Loading</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../paper/index.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">Data Loading</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">ResponseSequencer</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/githubpsyche/response_sequencer" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../index.html" class="sidebar-item-text sidebar-link">ResponseSequencer</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/00_Loading_Data.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Data Loading</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../paper/index.html" class="sidebar-item-text sidebar-link">Abstract</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../paper/01_introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sbs-narrative-recall-dataset" id="toc-sbs-narrative-recall-dataset" class="nav-link active" data-scroll-target="#sbs-narrative-recall-dataset">SBS Narrative Recall Dataset</a></li>
  <li><a href="#senses-dataset" id="toc-senses-dataset" class="nav-link" data-scroll-target="#senses-dataset">Senses Dataset</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/githubpsyche/response_sequencer/blob/master/notebooks/00_Loading_Data.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/githubpsyche/response_sequencer/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/githubpsyche/response_sequencer/blob/master/notebooks/00_Loading_Data.ipynb" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-title">Data Loading</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="sbs-narrative-recall-dataset" class="level2">
<h2 class="anchored" data-anchor-id="sbs-narrative-recall-dataset">SBS Narrative Recall Dataset</h2>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|export</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> Dataset</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SBS_NarrativeDataset(Dataset):</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, data_directory):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># each response file represents a sample; these are named based on '{story_name}_{subject_id}_{iteration}'</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data_directory <span class="op">=</span> data_directory</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.text_directory <span class="op">=</span> os.path.join(data_directory, <span class="st">'texts'</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sequence_directory <span class="op">=</span> os.path.join(data_directory, <span class="st">'sequences'</span>, <span class="st">'human'</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.response_files <span class="op">=</span> []</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stories <span class="op">=</span> {}</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> path, subdirs, files <span class="kw">in</span> os.walk(<span class="va">self</span>.text_directory):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> name <span class="kw">in</span> files:</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> name.count(<span class="st">'_'</span>) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.response_files.append(name)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">with</span> <span class="bu">open</span>(os.path.join(path, name), <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.stories[name[:<span class="op">-</span><span class="dv">4</span>]] <span class="op">=</span> f.read()</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.trial_indices <span class="op">=</span> np.arange(<span class="bu">len</span>(<span class="va">self</span>.response_files))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _retrieve_story_text(<span class="va">self</span>, response_file_name):</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        story_name <span class="op">=</span> response_file_name.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.stories[story_name]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _retrieve_response_text(<span class="va">self</span>, response_file_name):</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        story_name <span class="op">=</span> response_file_name.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(os.path.join(<span class="va">self</span>.text_directory, story_name, response_file_name), <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> f.read()</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _retrieve_response_sequence(<span class="va">self</span>, response_file_name):</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        story_name <span class="op">=</span> response_file_name.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(os.path.join(<span class="va">self</span>.sequence_directory, story_name, response_file_name[:<span class="op">-</span><span class="dv">3</span>]<span class="op">+</span><span class="st">'json'</span>), <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> json.load(f)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _prepare_match_matrix(<span class="va">self</span>, response_sequence):</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        matchings <span class="op">=</span> response_sequence[<span class="st">'correspondences'</span>]</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        match_matrix <span class="op">=</span> np.zeros(</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            (<span class="bu">len</span>(response_sequence[<span class="st">'source_units'</span>]), <span class="bu">len</span>(response_sequence[<span class="st">'response_units'</span>])), dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> response_index, matched_target <span class="kw">in</span> <span class="bu">enumerate</span>(matchings):</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> matched_target <span class="op">&gt;</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                match_matrix[matched_target, response_index] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> match_matrix</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _prepare_target_items(<span class="va">self</span>, story_text, response_sequence):</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        updated_unit_start <span class="op">=</span> [story_text.find(unit) <span class="cf">for</span> unit <span class="kw">in</span> response_sequence[<span class="st">'source_units'</span>]]</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index, unit <span class="kw">in</span> <span class="bu">enumerate</span>(response_sequence[<span class="st">'source_units'</span>]):</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">assert</span>(updated_unit_start[index] <span class="op">&gt;</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [{<span class="st">'text'</span>: unit, <span class="st">'spans'</span>:[(start, start<span class="op">+</span><span class="bu">len</span>(unit))]} <span class="cf">for</span> unit, start <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>            response_sequence[<span class="st">'source_units'</span>], updated_unit_start)]</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _prepare_response_units(<span class="va">self</span>, response_text, response_sequence):</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        updated_text <span class="op">=</span> [</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>            response_text[span[<span class="dv">0</span>]:span[<span class="dv">1</span>]].strip() <span class="cf">for</span> span <span class="kw">in</span> response_sequence[<span class="st">'response_spans'</span>]]</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [{<span class="st">'text'</span>: unit, <span class="st">'spans'</span>:[(span[<span class="dv">0</span>], span[<span class="dv">0</span>]<span class="op">+</span><span class="bu">len</span>(unit))]} <span class="cf">for</span> unit, span <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>            updated_text, response_sequence[<span class="st">'response_spans'</span>])]</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.response_files)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, idx):</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        trials <span class="op">=</span> []</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> trial_idx <span class="kw">in</span> np.atleast_1d(<span class="va">self</span>.trial_indices[idx]):</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>            response_file_name <span class="op">=</span> <span class="va">self</span>.response_files[trial_idx]</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>            story_text <span class="op">=</span> <span class="va">self</span>._retrieve_story_text(response_file_name)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>            response_text <span class="op">=</span> <span class="va">self</span>._retrieve_response_text(response_file_name)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>            response_sequence <span class="op">=</span> <span class="va">self</span>._retrieve_response_sequence(response_file_name)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>            trials.append({</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>                <span class="st">'target_context'</span>: story_text, </span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>                <span class="st">'target_items'</span>: <span class="va">self</span>._prepare_target_items(story_text, response_sequence), </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>                <span class="st">'response_transcript'</span>: response_text, </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>                <span class="st">'response_units'</span>: <span class="va">self</span>._prepare_response_units(response_text, response_sequence), </span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>                <span class="st">'matches'</span>: <span class="va">self</span>._prepare_match_matrix(response_sequence)})</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> trials[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(trials) <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> trials</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_directory <span class="op">=</span> <span class="st">'C:/Users/gunnj/compmempy/data/narrative'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> SBS_NarrativeDataset(data_directory)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>example_entry <span class="op">=</span> dataset[<span class="dv">0</span>]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>example_entry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>{'target_context': 'It was a hot, sunny day and Kaylie and Rachel decided to take advantage of their off day and take a trip to the beach. The sun was an optimistic yellow pellet, blistering in the sky as they were on their way to Old Orchard Beach in Maine. Once arriving and walking from the parking lot, they spotted the crystal clear water that faded into a deep blue on the horizon. The beach was swarming with people. Some on yellow, orange, white, and pink towels, while others were seen stretched out on lounge chairs with broad-brimmed hats shading their eyes from the rays of the sun. Children were decorating sandcastles with smooth, round seashells, and Kaylie decided to stretch out on her towel in the sand for a quick nap while Rachel went to cool off in the ocean. \nThe sun shined on the water, causing it to look like a million little crystals. Just before making it to the surf, Rachel saw a little girl with freckles in a light purple bathing suit and little yellow floaties on her arms. The girl darted in front of Rachel, closely followed by a boy in green swimming shorts. Rachel smiled as she reminisced on memories of beach days with her brothers. After spending some time in the water, she looked up and saw four teenagers flying colorful paragliders. She thought to herself that the day was truly perfect, and all anxieties from her daily life were absent for a while. She closed her eyes for a few seconds to savor the moment before going to lie down next to Kaylie in the warm sand.\n',
 'target_items': [{'text': 'It was a hot, sunny day ', 'spans': [(0, 24)]},
  {'text': 'and Kaylie and Rachel ', 'spans': [(24, 46)]},
  {'text': 'decided to take advantage of their off day ', 'spans': [(46, 89)]},
  {'text': 'and take a trip to the beach. ', 'spans': [(89, 119)]},
  {'text': 'The sun was an optimistic yellow pellet, ', 'spans': [(119, 160)]},
  {'text': 'blistering in the sky as they were on their way ',
   'spans': [(160, 208)]},
  {'text': 'to Old Orchard Beach ', 'spans': [(208, 229)]},
  {'text': 'in Maine. ', 'spans': [(229, 239)]},
  {'text': 'Once arriving and walking from the parking lot, ',
   'spans': [(239, 287)]},
  {'text': 'they spotted the crystal clear water ', 'spans': [(287, 324)]},
  {'text': 'that faded into a deep blue on the horizon.',
   'spans': [(324, 367)]},
  {'text': 'The beach was swarming with people. ', 'spans': [(368, 404)]},
  {'text': 'Some on yellow, orange, white, and pink towels, ',
   'spans': [(404, 452)]},
  {'text': 'while others were seen stretched out on lounge chairs ',
   'spans': [(452, 506)]},
  {'text': 'with broad-brimmed hats ', 'spans': [(506, 530)]},
  {'text': 'shading their eyes from the rays of the sun. ',
   'spans': [(530, 575)]},
  {'text': 'Children were decorating sandcastles with smooth, round seashells, ',
   'spans': [(575, 642)]},
  {'text': 'and Kaylie decided to stretch out on her towel ',
   'spans': [(642, 689)]},
  {'text': 'in the sand for a quick nap ', 'spans': [(689, 717)]},
  {'text': 'while Rachel went to cool off in the ocean. ',
   'spans': [(717, 761)]},
  {'text': 'The sun shined on the water, ', 'spans': [(762, 791)]},
  {'text': 'causing it to look like a million little crystals. ',
   'spans': [(791, 842)]},
  {'text': 'Just before making it to the surf, ', 'spans': [(842, 877)]},
  {'text': 'Rachel saw a little girl with freckles ', 'spans': [(877, 916)]},
  {'text': 'in a light purple bathing suit ', 'spans': [(916, 947)]},
  {'text': 'and little yellow floaties on her arms. ', 'spans': [(947, 987)]},
  {'text': 'The girl darted in front of Rachel, ', 'spans': [(987, 1023)]},
  {'text': 'closely followed by a boy ', 'spans': [(1023, 1049)]},
  {'text': 'in green swimming shorts. ', 'spans': [(1049, 1075)]},
  {'text': 'Rachel smiled as she reminisced on memories of beach days ',
   'spans': [(1075, 1133)]},
  {'text': 'with her brothers. ', 'spans': [(1133, 1152)]},
  {'text': 'After spending some time in the water, ', 'spans': [(1152, 1191)]},
  {'text': 'she looked up and', 'spans': [(1191, 1208)]},
  {'text': 'saw four teenagers ', 'spans': [(1209, 1228)]},
  {'text': 'flying colorful paragliders. ', 'spans': [(1228, 1257)]},
  {'text': 'She thought to herself that the day was truly perfect, ',
   'spans': [(1257, 1312)]},
  {'text': 'and all anxieties from her daily life were absent for a while. ',
   'spans': [(1312, 1375)]},
  {'text': 'She closed her eyes for a few seconds to savor the moment ',
   'spans': [(1375, 1433)]},
  {'text': 'before going to lie down next to Kaylie ',
   'spans': [(1433, 1473)]},
  {'text': 'in the warm sand.', 'spans': [(1473, 1490)]}],
 'response_transcript': 'It was a hot, sunny day and Rachel and her friend Kaylie decided it would be a good day to go to the beach.  They headed out to Old Orchard beach in Maine.  The sun looked like a hot, yellow pellet in the sky.   There were people laying under beach umbrellas wearing wide brimmed hats. Rachael decided that she would like to lay down in the sun before going swimming.  Kaylie dedcided to go for a swim.  A little girl in a light purple bathing suit with two floaties darted out in front of her followed closely by a boy in green shorts.  Kaylie smiled to herself remembering long past beach days with her brothers.  She saw 4 teenagers flying paragliders.  She thought about this as she walked over to lay down next to Rachel, thinking about what a perfect day this was turning out to be.',
 'response_units': [{'text': 'It was a hot, sunny day', 'spans': [(0, 23)]},
  {'text': 'and Rachel and her friend Kaylie', 'spans': [(24, 56)]},
  {'text': 'decided it would be a good day to go to the beach.',
   'spans': [(57, 107)]},
  {'text': 'They headed out to Old Orchard beach', 'spans': [(109, 145)]},
  {'text': 'in Maine.', 'spans': [(146, 155)]},
  {'text': 'The sun looked like a hot, yellow pellet in the sky',
   'spans': [(157, 208)]},
  {'text': 'There were people laying under beach umbrellas wearing wide brimmed hats.',
   'spans': [(212, 285)]},
  {'text': 'Rachael decided that she would like to lay down in the sun before going swimming.',
   'spans': [(286, 367)]},
  {'text': 'Kaylie dedcided to go for a swim.', 'spans': [(369, 402)]},
  {'text': 'A little girl', 'spans': [(404, 417)]},
  {'text': 'in a light purple bathing suit', 'spans': [(418, 448)]},
  {'text': 'with two floaties', 'spans': [(449, 466)]},
  {'text': 'darted out in front of her', 'spans': [(467, 493)]},
  {'text': 'followed closely by a boy', 'spans': [(494, 519)]},
  {'text': 'in green shorts', 'spans': [(520, 535)]},
  {'text': '.  Kaylie smiled to herself remembering long past beach days',
   'spans': [(535, 595)]},
  {'text': 'with her brothers', 'spans': [(596, 613)]},
  {'text': '.  She saw 4 teenagers', 'spans': [(613, 635)]},
  {'text': 'flying paragliders', 'spans': [(636, 654)]},
  {'text': '.  She thought about this as she walked over to lay down next to Rachel,',
   'spans': [(654, 726)]},
  {'text': 'thinking about what a perfect day this was turning out to be',
   'spans': [(727, 787)]}],
 'matches': array([[ True, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False,  True, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False,  True, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False,  True, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False,  True, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False,  True, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False,  True, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False,  True, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False,  True, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False,  True, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False,  True, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
          True, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False,  True],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False],
        [False, False, False, False, False, False, False, False, False,
         False, False, False, False, False, False, False, False, False,
         False, False, False]])}</code></pre>
</div>
</div>
</section>
<section id="senses-dataset" class="level2">
<h2 class="anchored" data-anchor-id="senses-dataset">Senses Dataset</h2>
<p>::: {.cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’ execution_count=16}</p>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> Dataset</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chardet</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hdf5storage</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SensesDataset(Dataset):</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, hdf5_file_path, sense_pool_path, transform<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the dataset.</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">            hdf5_file_path (str): Path to the HDF5 file.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">            sense_pool_path (str): Path to the sense pool file.</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">            transform (callable, optional): Optional transform to be applied</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">                on a sample. Defaults to None.</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load the data from the specified HDF5 file</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># You can customize this part to load your data</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> hdf5storage.read(path<span class="op">=</span><span class="st">'/data'</span>, filename<span class="op">=</span>hdf5_file_path)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.trial_count <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.data[<span class="st">"subject"</span>])</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.trial_indices <span class="op">=</span> np.arange(<span class="va">self</span>.trial_count)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(sense_pool_path, mode<span class="op">=</span><span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            raw_data <span class="op">=</span> f.read()</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            detected_encoding <span class="op">=</span> chardet.detect(raw_data)[<span class="st">'encoding'</span>]</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.sense_pool <span class="op">=</span> raw_data.decode(detected_encoding).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set the transform if provided</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transform <span class="op">=</span> transform</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">        Return the total number of samples in the dataset.</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co">            int: Number of trials in the dataset.</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.trial_count</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, idx):</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co">        Get a trial from the dataset at the specified index.</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">            trial_idx (int): Index of the trial to retrieve.</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co">            sample: The retrieved sample.</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># pres_itemids selects the indices from sense_pool of the target items</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        trials <span class="op">=</span> []</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> trial_idx <span class="kw">in</span> np.atleast_1d(<span class="va">self</span>.trial_indices[idx]):</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            senses <span class="op">=</span> <span class="va">self</span>.data[<span class="st">'pres_itemids'</span>][trial_idx]</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>            target_items <span class="op">=</span> [<span class="va">self</span>.sense_pool[each<span class="op">-</span><span class="dv">1</span>].strip() <span class="cf">for</span> each <span class="kw">in</span> senses <span class="cf">if</span> each <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># response units are the segments of the transcript selected by raters and their spans in the transcript</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>            response_transcript <span class="op">=</span> <span class="bu">str</span>(<span class="va">self</span>.data[<span class="st">'recall_transcript'</span>][trial_idx][<span class="dv">0</span>])</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>            response_units <span class="op">=</span> [<span class="bu">str</span>(each) <span class="cf">for</span> each <span class="kw">in</span> <span class="va">self</span>.data[<span class="st">'response_units'</span>][trial_idx] <span class="cf">if</span> <span class="bu">str</span>(each) <span class="op">!=</span> <span class="st">''</span>]</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>            <span class="co"># full response units include text *and* span representations contained in a dict</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>            response_start_spans <span class="op">=</span> [each<span class="op">-</span><span class="dv">1</span> <span class="cf">for</span> each <span class="kw">in</span> <span class="va">self</span>.data[<span class="st">"response_unit_start"</span>][trial_idx] <span class="cf">if</span> each <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>            response_end_spans <span class="op">=</span> [each<span class="op">-</span><span class="dv">1</span> <span class="cf">for</span> each <span class="kw">in</span> <span class="va">self</span>.data[<span class="st">"response_unit_end"</span>][trial_idx] <span class="cf">if</span> each <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>            full_response_units <span class="op">=</span> [{<span class="st">'text'</span>: unit, <span class="st">'spans'</span>:[(start_span, end_span)]} <span class="cf">for</span> unit, start_span, end_span <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>                response_units, response_start_spans, response_end_spans)]</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>            <span class="co"># matchings</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>            match_matrix <span class="op">=</span> np.zeros((<span class="bu">len</span>(target_items), <span class="bu">len</span>(response_units)), dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>            target_indices <span class="op">=</span> np.array([each<span class="op">-</span><span class="dv">1</span> <span class="cf">for</span> each <span class="kw">in</span> <span class="va">self</span>.data[<span class="st">'recalls'</span>][trial_idx] <span class="cf">if</span> each <span class="op">!=</span> <span class="dv">0</span>])</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(target_indices) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>                match_matrix[target_indices, np.arange(<span class="bu">len</span>(response_units))] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>            trials.append({</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>                <span class="st">'target_context'</span>: <span class="st">''</span>, </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>                <span class="st">'target_items'</span>: target_items, </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>                <span class="st">'response_transcript'</span>: response_transcript, </span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>                <span class="st">'response_units'</span>: full_response_units, </span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                <span class="st">'matches'</span>: match_matrix})</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> trials[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(trials) <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> trials</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>:::</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>section_tag <span class="op">=</span> <span class="st">'base'</span> <span class="co"># unique identifier for this variation of notebook parameters</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'C:/Users/gunnj/workspace/response_sequencer/data/'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> SensesDataset(os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>section_tag<span class="sc">}</span><span class="ss">_senses.h5'</span>), os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>section_tag<span class="sc">}</span><span class="ss">_sense_pool.txt'</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dataset[:<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>[{'target_context': '',
  'target_items': ['(n) ace (one of four playing cards in a deck having a single pip on its face)',
   '(n) ace, adept, champion, sensation, maven, mavin, virtuoso, genius, hotshot, star, superstar, whiz, whizz, wizard, wiz (someone who is dazzlingly skilled in any field)',
   '(n) ace (a serve that the receiver is unable to reach)',
   '(v) breeze through, ace, pass with flying colors, sweep through, sail through, nail (succeed at easily) "She sailed through her exams"; "You will pass with flying colors"; "She nailed her astrophysics course"',
   '(v) ace (serve an ace against (someone))',
   '(n) one, 1, I, ace, single, unity (the smallest whole number or a numeral representing this number) "he has the one but will need a two and three to go with it"; "they had lunch at one"',
   '(adj) ace, A-one, crack, first-rate, super, tiptop, topnotch, top-notch, tops (of the highest quality) "an ace reporter"; "a crack shot"; "a first-rate golfer"; "a super party"; "played top-notch tennis"; "an athlete in tiptop condition"; "she is absolutely tops"',
   '(v) ace (play (a hole) in one stroke)',
   '(n) 5: a combat pilot who has brought down at least five enemy airplanes'],
  'response_transcript': "Ace, um, I think it's like a, something to do with tennis, I don't really know. Um, there's also, like, um, in a card game there's the ace, um, which is like generally, like the highest point card, God, I haven't played cards in so long. Um, an ace can be someone that's really good at something.",
  'response_units': [{'text': "Ace, um, I think it's like a, something to do with tennis, I don't really know. Um, there's also, like, um,",
    'spans': [(0, 107)]},
   {'text': "in a card game there's the ace, um, which is like generally, like the highest point card, God, I haven't played cards in so long. Um,",
    'spans': [(108, 241)]},
   {'text': "an ace can be someone that's really good at something",
    'spans': [(242, 295)]}],
  'matches': array([[False,  True, False],
         [False, False,  True],
         [ True, False, False],
         [False, False, False],
         [False, False, False],
         [False, False, False],
         [False, False, False],
         [False, False, False],
         [False, False, False]])},
 {'target_context': '',
  'target_items': ['(n) wake, backwash (the wave that spreads behind a boat as it moves forward) "the motorboat\'s wake capsized the canoe"',
   '(n) wake, viewing (a vigil held over a corpse the night before burial) "there\'s no weeping at an Irish wake"',
   '(v) wake up, awake, arouse, awaken, wake, come alive, waken (stop sleeping) "She woke up to the sound of the alarm clock"',
   '(v) wake (be awake, be alert, be there)',
   '(v) wake (make aware of) "His words woke us to terrible facts of the situation"',
   '(v) awaken, wake, waken, rouse, wake up, arouse (cause to become awake or conscious) "He was roused by the drunken men in the street"; "Please wake me at 6 AM."',
   '(n) aftermath, wake, backwash (the consequences of an event (especially a catastrophic event)) "the aftermath of war"; "in the wake of the accident no one knew how many had been injured"',
   '(v) inflame, stir up, wake, ignite, heat, fire up (arouse or excite feelings and passions) "The ostentatious way of living of the rich ignites the hatred of the poor"; "The refugees\' fate stirred up compassion around the world"; "Wake old feelings of hatred"'],
  'response_transcript': "Um, wake can be, like, you, it's, it can be like a verb, like you are, um, waking up from sleep. Um, a wake can also be an, like, event, kind of like a funeral, or celebration of someone's life. Um, um, I feel like there's also a meaning of wake that has something to do with water, but I can't think of what it is, exactly. Like, waves, maybe, something to do with, like, the waves. Um I don't know. I don't know. I guess, like, um, a wake can also be, like, a mode on an alarm clock, 'cause like the sleep-wake, um. . . Yeah.",
  'response_units': [{'text': "Um, wake can be, like, you, it's, it can be like a verb, like you are, um, waking up from sleep. Um",
    'spans': [(0, 99)]},
   {'text': "a wake can also be an, like, event, kind of like a funeral, or celebration of someone's life. Um, um",
    'spans': [(101, 201)]},
   {'text': "I feel like there's also a meaning of wake that has something to do with water, but I can't think of what it is, exactly. Like, waves, maybe, something to do with, like, the waves. Um I don't know. I don't know.",
    'spans': [(203, 414)]}],
  'matches': array([[False, False,  True],
         [False,  True, False],
         [ True, False, False],
         [False, False, False],
         [False, False, False],
         [False, False, False],
         [False, False, False],
         [False, False, False]])}]</code></pre>
</div>
</div>
<p>::: {.cell 0=‘h’ 1=‘i’ 2=‘d’ 3=‘e’ execution_count=18}</p>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nbdev<span class="op">;</span> nbdev.nbdev_export()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>:::</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">ResponseSequencer</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../paper/index.html" class="pagination-link">
        <span class="nav-page-text">Abstract</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>